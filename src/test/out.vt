DEFINE_UNIT(io, std-io:io)
   BODY:
      DEFINE(println)
         VALUE:
            LOAD(__refl__)
            CALL(reflect)
               ARGS:
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Std.IO.PrintlnFn)
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Collections.WattList@5b80350b)
      DEFINE(print)
         VALUE:
            LOAD(__refl__)
            CALL(reflect)
               ARGS:
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Std.IO.PrintFn)
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Collections.WattList@5d6f64b1)
      DEFINE(input)
         VALUE:
            LOAD(__refl__)
            CALL(reflect)
               ARGS:
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Std.IO.InputFn)
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Collections.WattList@32a1bec0)
DEFINE_UNIT(WeatherType, net-owm:WeatherType)
   BODY:
      DEFINE(JSON)
         VALUE:
            PUSH(json)
      DEFINE(JAVA)
         VALUE:
            PUSH(java)
      DEFINE(HTML)
         VALUE:
            PUSH(html)
      DEFINE(XML)
         VALUE:
            PUSH(xml)
DEFINE_TYPE(OwmClient, net-owm:OwmClient)
   BODY:
      DEFINE(owm_reflection)
         VALUE:
            LOAD(__refl__)
            CALL(reflect)
               ARGS:
                  PUSH(com.kilowatt.Compiler.Builtins.Libraries.Net.NetOwm)
                  LIST()
      DEFINE(connection)
         VALUE:
            LOAD(owm_reflection)
            CALL(connect)
               ARGS:
                  LOAD(api_key)
      DEFINE(single_requester)
         VALUE:
            LOAD(connection)
            CALL(currentWeather)
               ARGS:
            CALL(single)
               ARGS:
      DEFINE_FN(get_weather, null)
         BODY:
            IF():
               CONDITIONS:
                  LOAD(ret_type)
                  PUSH(html)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(html)
                  RET()
                     VALUE:
                        LOAD(customizer)
                        CALL(retrieve)
                           ARGS:
                        CALL(asHTML)
                           ARGS:
            ELSE():
            IF():
               CONDITIONS:
                  LOAD(ret_type)
                  PUSH(java)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(java)
                  RET()
                     VALUE:
                        LOAD(customizer)
                        CALL(retrieve)
                           ARGS:
                        CALL(asJava)
                           ARGS:
            ELSE():
            IF():
               CONDITIONS:
                  LOAD(ret_type)
                  PUSH(json)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(json)
                  RET()
                     VALUE:
                        LOAD(customizer)
                        CALL(retrieve)
                           ARGS:
                        CALL(asJSON)
                           ARGS:
            ELSE():
            IF():
               CONDITIONS:
                  LOAD(ret_type)
                  PUSH(xml)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(xml)
                  RET()
                     VALUE:
                        LOAD(customizer)
                        CALL(retrieve)
                           ARGS:
                        CALL(asXML)
                           ARGS:
            ELSE():
            IF():
               CONDITIONS:
                  PUSH(true)
               BODY:
                  CALL(error)
                     ARGS:
                        PUSH(undefined type of weather retrieve: )
                        LOAD(ret_type)
                        BIN_OP(+)
                        PUSH(available: html, java, json, xml)
            RET()
               VALUE:
                  PUSH(null)
         ARGS:
            customizer
            ret_type
      MAKE_CLOSURE(FN:get_weather)
      DEFINE_FN(city, null)
         BODY:
            LOAD(io)
            CALL(println)
               ARGS:
                  LOAD(language)
                  PUSH(ru)
                  COND_OP(==)
            IF():
               CONDITIONS:
                  LOAD(language)
                  PUSH(ru)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(ru)
                  RET()
                     VALUE:
                        LOAD(self)
                        CALL(get_weather)
                           ARGS:
                              LOAD(single_requester)
                              CALL(byCityName)
                                 ARGS:
                                    LOAD(name)
                              CALL(language)
                                 ARGS:
                                    LOAD(owm_reflection)
                                    LOAD(RU)
                              LOAD(ret_type)
            ELSE():
            IF():
               CONDITIONS:
                  LOAD(language)
                  PUSH(en)
                  COND_OP(==)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(en)
                  RET()
                     VALUE:
                        LOAD(self)
                        CALL(get_weather)
                           ARGS:
                              LOAD(single_requester)
                              CALL(byCityName)
                                 ARGS:
                                    LOAD(name)
                              CALL(language)
                                 ARGS:
                                    LOAD(owm_reflection)
                                    LOAD(EN)
                              LOAD(ret_type)
            ELSE():
            IF():
               CONDITIONS:
                  PUSH(true)
               BODY:
                  LOAD(io)
                  CALL(println)
                     ARGS:
                        PUSH(other)
                  CALL(error)
                     ARGS:
                        PUSH(lang: )
                        LOAD(language)
                        BIN_OP(+)
                        PUSH( is not available.)
                        BIN_OP(+)
                        PUSH(available: ru, en)
            RET()
               VALUE:
                  PUSH(null)
         ARGS:
            name
            language
            ret_type
      MAKE_CLOSURE(FN:city)
      DEFINE_FN(city_id, null)
         BODY:
            RET()
               VALUE:
                  LOAD(owm_reflection)
                  CALL(city_id)
                     ARGS:
                        LOAD(single_requester)
            RET()
               VALUE:
                  PUSH(null)
         ARGS:
      MAKE_CLOSURE(FN:city_id)
   ARGS:
      api_key
DEFINE(owm)
   VALUE:
      INSTANCE(OwmClient)
         CONSTRUCTOR:
            PUSH(someowmapikey)
DEFINE(weather)
   VALUE:
      LOAD(owm)
      CALL(city)
         ARGS:
            PUSH(Moscow)
            PUSH(ru)
            PUSH(json)
LOAD(io)
CALL(println)
   ARGS:
      LOAD(weather)
